{% extends 'base.html' %}
{% load custom_filters %} 
{% block title %}Mi Horario - Alumno{% endblock %}

{% block sidebar %}
    {% include 'includes/student_sidebar.html' %}
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="h3 mb-0 text-primary fw-bold"><i class="bi bi-calendar-week me-2"></i>Mi Horario Semanal</h2>
        <p class="text-muted small mb-0">Semestre Académico 2025-2</p>
    </div>
    <button class="btn btn-outline-primary shadow-sm no-print" onclick="window.print()">
        <i class="bi bi-printer me-2"></i> Imprimir PDF
    </button>
</div>

<div id="printable-area">
    <div class="d-none d-print-block mb-3 text-center">
        <h3>Horario de Clases - {{ user.get_full_name }}</h3>
    </div>

    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="schedule-table table mb-0">
                    <thead>
                        <tr>
                            <th style="width: 80px;">Hora</th>
                            <th>Lunes</th>
                            <th>Martes</th>
                            <th>Miércoles</th>
                            <th>Jueves</th>
                            <th>Viernes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for slot in time_slots %}
                        <tr>
                            <td class="time-cell">
                                {{ slot.start }} - {{ slot.end }}
                            </td>
                            
                            {% for day in days %}
                                <td>
                                    {% with courses=schedule_grid|get_item:day|get_item:slot.start %}
                                        {% if courses %}
                                            {% for course_info in courses %}
                                                <div class="course-block color-{{ course_info.color_index }} {% if courses|length > 1 %}collision-warning{% endif %}"
                                                     title="{{ course_info.name }}">
                                                    
                                                    <div class="course-room small text-uppercase mb-1 opacity-75">
                                                        <i class="bi bi-geo-alt-fill me-1"></i> 
                                                        {{ course_info.room }} - {{ course_info.group }}
                                                    </div>

                                                    <div class="course-name lh-sm">
                                                        {{ course_info.name }}
                                                    </div>
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                    {% endwith %}
                                </td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

{% if has_collisions %}
<div class="alert alert-warning mt-3 shadow-sm no-print d-flex align-items-center">
    <i class="bi bi-exclamation-triangle-fill fs-4 me-3"></i>
    <div>
        <strong>Conflicto detectado:</strong> Hay cursos que se solapan en el mismo horario (bordes rojos).
    </div>
</div>
{% endif %}

{% endblock %}